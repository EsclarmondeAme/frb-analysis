# ================================================================
#  Final Harmonic Alignment Score
#  Standalone version â€” no files, pure numbers from your tests
#  Uses:
#     - Test 112A persistent fractions (f_lm)
#     - Test 111B p_E, p_F (energy + flux p-values)
#     - Test 110A strongest cycles (cycle membership)
#
#  Score formula:
#       S = f_lm * (1 - p_E) * (1 - p_F) + cycle_weight
# ================================================================

import pandas as pd

# ------------------------------------------------
# 1. persistent fractions from Test 112A
# ------------------------------------------------
persistent = {
    (0,0):1.00,
    (1,-1):1.00,
    (1, 0):1.00,
    (1, 1):1.00,
    (2,-1):1.00,
    (2, 1):1.00,
    (3, 2):0.50,
    (3,-2):0.50,
    (2, 2):0.38,
    (2,-2):0.38,
    (6,-2):0.25,
    (6, 2):0.25,
}

# ------------------------------------------------
# 2. energy/flux p-values from Test 111B (your extracted table)
# ------------------------------------------------
pvals = {
(0,0):(0.0000,1.000),
(1,-1):(0.2870,0.999),
(1, 0):(0.4835,0.411),
(1, 1):(0.2870,0.999),
(2,-2):(0.3215,0.973),
(2,-1):(0.0385,0.946),
(2, 0):(0.0190,0.059),
(2, 1):(0.0385,0.946),
(2, 2):(0.3215,0.973),
(3,-3):(0.0040,0.892),
(3,-2):(0.0040,0.9905),
(3,-1):(0.0000,0.358),
(3, 0):(0.1485,0.7855),
(3, 1):(0.0000,0.358),
(3, 2):(0.0040,0.9905),
(3, 3):(0.0040,0.892),
(4,-4):(0.0005,0.621),
(4,-3):(0.4430,0.992),
(4,-2):(0.0340,0.835),
(4,-1):(0.0010,0.013),
(4, 0):(0.5860,0.597),
(4, 1):(0.0010,0.013),
(4, 2):(0.0340,0.835),
(4, 3):(0.4430,0.992),
(4, 4):(0.0005,0.621),
(5,-5):(0.0010,0.138),
(5,-4):(0.7930,0.984),
(5,-3):(0.0710,0.984),
(5,-2):(0.0000,0.092),
(5,-1):(0.1670,0.327),
(5, 0):(0.0210,0.479),
(5, 1):(0.1670,0.327),
(5, 2):(0.0000,0.092),
(5, 3):(0.0710,0.984),
(5, 4):(0.7930,0.984),
(5, 5):(0.0010,0.138),
(6,-6):(0.0010,0.270),
(6,-5):(0.0020,0.959),
(6,-4):(0.1800,0.993),
(6,-3):(0.0010,0.539),
(6,-2):(0.0000,0.172),
(6,-1):(0.1480,0.667),
(6, 0):(0.0030,0.229),
(6, 1):(0.1480,0.667),
(6, 2):(0.0000,0.172),
(6, 3):(0.0010,0.539),
(6, 4):(0.1800,0.993),
(6, 5):(0.0020,0.959),
(6, 6):(0.0010,0.270),
}

# ------------------------------------------------
# 3. cycle membership from Test 110A
#    We give +0.25 for being in a cycle, +0.50 for being in 2 cycles
# ------------------------------------------------

cycle_list = [
    [(1,0),(3,-3),(5,0)],
    [(1,0),(3,3),(5,0)],
    [(2,0),(3,-3),(5,0)],
    [(2,0),(3,3),(5,0)],
    [(1,0),(3,-3),(6,-5)],
    [(1,0),(3,-3),(6,5)],
    [(1,0),(3,3),(6,-5)],
    [(1,0),(3,3),(6,5)],
    [(2,0),(3,-3),(6,-5)],
    [(2,0),(3,-3),(6,5)],
]

cycle_weight = {}

for cyc in cycle_list:
    for lm in cyc:
        cycle_weight[lm] = cycle_weight.get(lm,0) + 0.25

# ------------------------------------------------
# 4. Compute alignment scores
# ------------------------------------------------

rows = []

for (l,m), (pE,pF) in pvals.items():

    f = persistent.get((l,m), 0.0)
    cyc = cycle_weight.get((l,m), 0.0)

    S = f * (1 - pE) * (1 - pF) + cyc

    rows.append({"l":l, "m":m, 
                 "f_lm":f, "pE":pE, "pF":pF, 
                 "cycle":cyc, 
                 "Alignment":S})

df = pd.DataFrame(rows)
df = df.sort_values("Alignment", ascending=False)

print("\n==============================")
print(" FINAL HARMONIC ALIGNMENT")
print("==============================\n")
print(df.to_string(index=False))

print("\nTOP 15 MODES:\n")
print(df.head(15).to_string(index=False))
